@page "/my-requests"
@attribute [Microsoft.AspNetCore.Authorization.Authorize]

<PageTitle>My Requests</PageTitle>

<MudText Typo="Typo.h4" GutterBottom="true">My Service Requests</MudText>

@if (_isLoading)
{
    <MudProgressCircular Indeterminate="true" Color="Color.Primary" />
    <MudText Class="mt-2">Loading your requests...</MudText>
}
else if (_requests is null || _requests.Count == 0)
{
    <MudAlert Severity="Severity.Info">
        You haven't submitted any service requests yet.
        <MudLink Href="/submit-request">Submit your first request</MudLink>.
    </MudAlert>
}
else
{
    <MudText Class="mb-3">You have <b>@_requests.Count</b> service request(s).</MudText>

    @foreach (var request in _requests)
    {
        <MudCard Elevation="2" Class="mb-3">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">@request.IssueCategory â€” @request.UrgencyLevel</MudText>
                </CardHeaderContent>
                <CardHeaderActions>
                    <MudChip T="string" Color="Color.Success" Size="Size.Small">@request.Status</MudChip>
                </CardHeaderActions>
            </MudCardHeader>
            <MudCardContent>
                <MudText>@request.IssueDescription</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mt-2">
                    <MudIcon Icon="@Icons.Material.Filled.LocationOn" Size="Size.Small" /> @request.Street, @request.City, @request.State @request.ZipCode
                </MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary">
                    <MudIcon Icon="@Icons.Material.Filled.CalendarMonth" Size="Size.Small" /> @request.CreatedAt.LocalDateTime.ToString("MMM d, yyyy h:mm tt")
                </MudText>
            </MudCardContent>
            <MudCardActions>
                <MudButton Variant="Variant.Outlined" Color="Color.Primary" Href="@($"/request-confirmation/{request.Id}")"
                           StartIcon="@Icons.Material.Filled.Visibility" Size="Size.Small">View Details</MudButton>
            </MudCardActions>
        </MudCard>
    }
}
